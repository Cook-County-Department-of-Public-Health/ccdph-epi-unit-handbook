# Secondary Data {.unnumbered}

Secondary data refers to data that has been collected by someone other than CCDPH and is therefore not originally generated by the Epidemiology Unit for a specific purpose. These data can include state (e.g., IDPH) and federal (e.g., from the CDC, Census Bureau, or EPA) government datasets, and many other sources. The Epidemiology Unit uses secondary data to develop public health indicators, and explore relationships. This chapter summarizes specific secondary data sources used by the Epidemiology Unit and how they are accessed.

```{r}
#| eval: true
#| echo: false

library(DBI)
library(odbc)
library(dplyr)
library(tidyverse)
library(DT)
library(keyring)
library(stringr)
library(openxlsx)
library(data.table)
library(sf)
```

## Hospital discharge data

Hospital discharge data are administrative data collected when a patient is discharged from a hospital. Inpatient data is collected on patients admitted to a hospital for an overnight stay, while outpatient data is collected on patients who receive services from a hospital but do not stay overnight. The CCDPH receives both [inpatient and outpatient data](https://dph.illinois.gov/topics-services/prevention-wellness/patient-safety-quality/discharge-data.html) from the Illinois Department of Public Health (IDPH) on an irregular basis. The discharge data include patient demographic information, diagnosis codes, procedures codes, charges, among other data (see data dictionary below).

Code for processing hospital discharge data is managed via the ccdph-hospital-discharge GitHub repository. Hospital data 

```{r}
#| label: hospital discharge data dictionary
#| eval: true
#| echo: true

con_epi_discharge <- dbConnect(odbc::odbc(), 
                               Driver = "SQL Server",
                               Server = key_get("ccdph_sql_server"),
                               Database = "epi-discharge")

discharges_data_dictionary_2010_2020 <- dbReadTable(conn = con_epi_discharge, 
             Id(schema="raw", 
                table="discharges_data_dictionary_2010_2020"))

discharges_data_dictionary_2010_2020 %>%
  select(Name:Format) %>%
    datatable(class = 'cell-border stripe',
            rownames = FALSE,
            options = list(pageLength = 10,
                           dom="t")) %>%
  formatStyle(columns = c(1:3),
              fontSize = '75%')

# discharges_data_dictionary_2010_2020 %>%
#   select(Name:Format) %>%
#   kable(align = "lrr") %>%
#   kable_styling(
#     bootstrap_options = c("striped", "hover", "condensed"))

dbDisconnect(con_epi_discharge)
```


Once received, the Epidemiology Unit cleans, processes and creates a variety of indicators--as both frequencies or counts and age-standardized rates--of hospital discharges for select diagnoses at multiple geographic aggregations including suburban Cook County, CCDPH's jurisdiction and by zip code. These rates are then made available on the [Cook County Health Atlas](https://cookcountyhealthatlas.org/) and other data briefs and reports. This document walks through the process for requesting, importing, cleaning and analyzing hospitalization inpatient and outpatient discharge data.

### Request and download hospital disccharge data from IDPH

CCDPH is not able to access hospitalization discharge data directly through an API or other dynamic means. Rather the Epidemiology Unit must request the data from a designated IDPH contact person via a formal process. The latest hospitalization data received by CCDPH (years 2010 through 2020) were acquired March 2022. The IDPH contact person at that time was Rich \[Orland\] Forshee, [orland.forshee\@illinois.gov](mailto:orland.forshee@illinois.gov), Data Analyst for IDPH's Division of Patient Safety and Quality (525 W Jefferson, Floor 2 Springfield, IL 62761; phone: 217-782-6320).

The process begins by receiving a data use agreement (DUA) made available from IDPH which is promptly sent over to CCDPH's legal team to review. Once both parties agree on the terms of the DUA, the Epi Unit obtains signatures from data users/handlers as well as CCDPH's Director. Once the contract is signed by all relevant parties, it is returned to IDPH who then makes the data available for download. In March 2022, the Epidemiology Unit requested that the data be made available as a flat file in CSV format. The data, which includes protected health information (PHI), were downloaded to the Epi Unit's network drive under a standard directory.


## Vital statistics

## Census data
Demographic data, standardized population data