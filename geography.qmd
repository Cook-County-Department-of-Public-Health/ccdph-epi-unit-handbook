```{r}
#| eval: true
#| echo: false

library(dplyr)
library(dbplyr)
library(tidyverse)
library(sf)
library(sp)
library(leaflet)
library(leaflet.providers)
library(keyring)

source("https://raw.githubusercontent.com/Cook-County-Department-of-Public-Health/ccdph-functions/master/spatial-database-functions.R")
```

# Geography {.unnumbered}
This chapter summarizes the geography of CCDPH's jurisdiction and the geographies *within* CCDPH's jurisdiction. Many of the legally defined geographic boundaries discussed in this chapter change over time due to annexations by cities, delineation of political districts, accuracy updates, or other reasons. The Epidemiology and Communicable Disease units develop and share code used to produce and manage geographic layers via the [cchdph-shapefiles](https://github.com/Cook-County-Department-of-Public-Health/ccdph-shapefiles) GitHub repository. Zipped versions of output geographic shapefiles are available in the GitHub repository as well as the CCDPH SQL Server *inter-spatial* database. For more information on how to access geographic data, refer to the [Storage and Access chapter][storage.qmd] section of the handbook. 

## CCDPH jurisdiction
Cook County Department of Public Health (CCDPH) was established in 1945 and is the state-certified public health agency for most of suburban Cook County (SCC). CCDPH’s jurisdiction is within the largely urban Bellwood health region, one of [seven health regions within the state of Illinois](https://dph.illinois.gov/contact-us/regional-health-departments.html). CCDPH has an approximate area of 693 square miles and serves 2.3 million residents (Census Bureau 2020).

# Geographic boundaries as units of analysis
The Epidemiology Unit reports public health information for many geographic units of analysis or boundaries beyond CCDPH's jurisdiction. Selecting an appropriate geographic unit depends on the scope and focus of the given analysis. For example, a coarse-grained assessment of death rates may report mortality trends for CCDPH's jurisdiction as whole, whereas a fine-grained study of morbidity, for example, may examine variations in emergency department visits by municipality or census tract.

What follows are brief descriptions of the most commonly used geographic units or boundaries employed by Epidemiology Unit staff beyond the CCDPH's jurisdiction. For the most part, boundaries are arranged in descending order by size (i.e., area). Refer to the interactive boundaries map to visually compare differences between the various geographic layers [link to interactive map].

## Interactive map of CCDPH-related geographies

@fig-geographies provides an interactive display of the most commonly used geographic units or boundaries used by Epidemiology Unit staff. 

```{r}
#| label: fig-geographies
#| fig-cap: CCDPH-Related Geographies
#| eval: true
#| echo: true

# import GIS layers from inter-spatial
ccdph_boundary <- fx_read_spatial_layer_fr_database(db_table_name = "ccdph_boundary", crs_id = 4326)
scc_boundary <- fx_read_spatial_layer_fr_database(db_table_name = "scc_boundary", crs_id = 4326)
counties_illinois <- fx_read_spatial_layer_fr_database(db_table_name = "counties_illinois", crs_id = 4326) %>% dplyr::filter(geoid_county=="17031")
munis_cook_county_clipped <- fx_read_spatial_layer_fr_database(db_table_name = "munis_cook_county_clipped", crs_id = 4326)
ccdph_districts <- fx_read_spatial_layer_fr_database(db_table_name = "ccdph_district_boundaries_muni", crs_id = 4326)

# labels_districts <- sprintf(
#   "<strong>%s</strong><br/>
#   %s mi<sup>2</sup>",
#   paste0(studyarea_counties_acs$name_county," County"),
#   paste0("Area: ", prettyNum(studyarea_counties_acs$sqmi_county,digits=2, big.mark = ","))) %>% lapply(htmltools::HTML)
# 
# labels_scc <- sprintf(
#   "<strong>%s</strong><br/>
#   %s mi<sup>2</sup>",
#   paste0(studyarea_counties_acs$name_county," County"),
#   paste0("Area: ", prettyNum(studyarea_counties_acs$sqmi_county,digits=2, big.mark = ","))) %>% lapply(htmltools::HTML)
# 
# labels_ccdph <- sprintf(
#   "<strong>%s</strong><br/>
#   %s mi<sup>2</sup>",
#   paste0(studyarea_counties_acs$name_county," County"),
#   paste0("Area: ", prettyNum(studyarea_counties_acs$sqmi_county,digits=2, big.mark = ","))) %>% lapply(htmltools::HTML)
# 
# labels_muni <- sprintf(
#   "<strong>%s</strong><br/>
#   %s mi<sup>2</sup>",
#   paste0(studyarea_counties_acs$name_county," County"),
#   paste0("Area: ", prettyNum(studyarea_counties_acs$sqmi_county,digits=2, big.mark = ","))) %>% lapply(htmltools::HTML)

leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(group = "Cook County",
              data=counties_illinois,
              fillColor = "orange",
              weight = 2,
              opacity = 0.5,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7) %>%
  addPolygons(group = "CCDPH",
              data = ccdph_boundary,
              weight = 2,
              opacity = 0.5,
              color = "white",
              dashArray = "3",
              fillColor = "darkblue",
              fillOpacity = 0.7) %>%
  addPolygons(group = "SCC",
              data = scc_boundary,
              weight = 2,
              opacity = 0.5,
              color = "white",
              dashArray = "3",
              fillColor = "lightblue",
              fillOpacity = 0.7) %>%
  addPolygons(group = "Munis",
              data = munis_cook_county_clipped,
              weight = 2,
              opacity = 0.5,
              color = "white",
              dashArray = "1",
              fillColor = "lightyellow",
              fillOpacity = 0.7) %>%
  addPolygons(group = "Districts",
              data = ccdph_districts %>% dplyr::filter(name_district !="OOJ"),
              weight = 2,
              opacity = 0.5,
              color = "black",
              dashArray = "1",
              fillColor = NULL,
              fillOpacity = 0) %>%
      addLayersControl(
          overlayGroups =c("Cook County","CCDPH","SCC","Munis","Districts"),
          options = layersControlOptions(collapsed=FALSE)
          ) %>%
  hideGroup(c("CCDPH","SCC","Munis","Districts"))

```

## Cook County (aka Bellwood health region)
Cook County is one of Illinois' 102 counties and is the largest county in Illinois in terms of population, comprising over 40 percent of the total population of Illinois. The Bellwood health region, which shares the same boundary as Cook County, is the smallest of the state’s health regions in terms of area  (1,635 square miles), although it has the most residents (5.2 million in 2020) and comprises over 40 percent of the total population of Illinois.

CCDPH is one of six local health departments (LHDs) within Cook County. The other five are the [Chicago Department of Public Health](https://www.chicago.gov/city/en/depts/cdph.html), the [City of Evanston Department of Health and Human Services](https://www.cityofevanston.org/government/departments/health-human-services), the [Village of Oak Park Department of Public Health](https://www.oak-park.us/village-services/department-public-health), the [Stickney Township Public Health District](http://stickneypublichealthdistrict.org/) and the [Village of Skokie Health Department](https://www.skokie.org/158/Health). The [latest contact information for local health departments in Illinois](https://idph.illinois.gov/IDPHPrograms/v_LHDDirectory/Show-V-LHDDirectory-Public.aspx?RegionServed=7) can be found on the Illinois Department of Public Health website.

## Suburban Cook County (SCC)
Suburban Cook County or SCC refers to the entire area of Cook County excluding the city of Chicago. It has an area of approximately XX square miles. Suburban Cook County includes the CCDPH jurisdiction as well as the areas of the other four local health departments. According to the 2020 decennial census, SCC has a population of.

## CCDPH health districts

and four CCDPH public health districts: north, west, southwest and south. These four CCDPH public health districts are used by CCDPH largely to evaluate social and demographic patterns across its jurisdiction, as well as to enumerate and report the incidence and prevalence of disease and other health indicators.

## SCC municipalities 
CCDPH’s jurisdiction includes 120 municipalities, 114 in their entirety and portions of six others. The unincorporated area population (i.e., the population residing outside of the 120 incorporated municipalities) within CCDPH is estimated to be about 104,874, or 4.6 percent of the jurisdiction’s total. 

## Cook County townships

## Cook County zip code tabulation reas (ZCTAs)

## Census tracts

## Political boundaries

